<script>
let isAnimating = false;

/* =======================
   ФИНАЛЬНЫЙ ВОПРОС
======================= */
const finalQuestion =
"Какой вопрос ты сам(а) хотел(а) бы, чтобы я тебе задал(а) - и какой был бы твой ответ?";

/* =======================
   ВОПРОСЫ (ВСЕ ТВОИ, БЕЗ ИЗМЕНЕНИЙ)
======================= */

// 1️⃣ ЛЁГКИЕ (6)
const lightQuestions = [
    "Какой твой любимый цвет?",
    "С каким животным я у тебя ассоциируюсь?",
    "Какая привычка из детства до сих пор с тобой?",
    "Какое слово тебе нравится слышать в свой адрес?",
    "Что тебя быстрее всего успокаивает?",
    "Какая твоя маленькая слабость делает тебя тобой?"
];

// 2️⃣ СРЕДНИЕ (включая Лозу)
const mediumQuestions = [
    "Какой твой самый большой страх?",
    "Какая деталь тебе во мне нравится как в человеке на основе нашего общения?",
    "Что тебе труднее всего говорить вслух даже близким?",
    "О чем ты чаще всего думаешь ночью, когда никто не отвлекает?",
    "Какой комплимент тебе важнее всего услышать?",
    "В чём ты чаще всего сомневаешься в себе?",
    "Что тебя может прямо взбесить?",
    "Что ты считаешь своей сильной стороной, но редко используешь?",
    "Что для тебя значит «уважение» в отношениях?",
    "Как ты любишь, чтобы тебя поддерживали: словами, делом или присутствием?",
    "Что ты никогда не просишь, хотя тебе это нужно?",
    "Что ты ценишь в человеке больше всего?",
    "Что ты хочешь, чтобы я понял(а) про тебя без догадок - напрямую?",
    "Что во мне тебе откликается, потому что похоже на тебя?",
    "Какой теории ты придерживаешься: Земля плоская или сферическая (элипсообразная)? Автор вопроса: Юрий Лоза."
];

// 3️⃣ САМЫЕ ОТКРОВЕННЫЕ
const deepQuestions = [
    "Есть ли у тебя в жизни ситуация, глядя на которую спустя годы ты понимаешь, что нужно было поступить иначе?",
    "Что ты на самом деле очень любишь, но демонстрируешь вообще обратное?",
    "Что тебя трогает до глубины, но ты это скрываешь?",
    "Какая привычка из детства до сих пор с тобой?",
    "Что ты не успел(а) сказать человеку - и до сих пор помнишь?",
    "Что ты считаешь настоящей близостью?",
    "В каких ситуациях ты чувствуешь себя особенно одиноко?",
    "Что ты всегда прощаешь людям?",
    "В каких ситуациях ты чувствуешь ревность и почему?",
    "Какое твоё правило по жизни ты нарушаешь чаще всего?",
    "Что ты считаешь домом - это место или человек?",
    "Когда тебе плохо, ты хочешь, чтобы тебя оставили в покое или были рядом?",
    "Что ты хотел(а) бы научиться говорить без страха?",
    "Какой, по твоему мнению, твой самый сильный поступок, за который ты гордишься?"
];

/* =======================
   СОСТОЯНИЕ
======================= */

let stage = 0; // 0 — light, 1 — medium, 2 — deep, 3 — final, 4 — end

let pools = [
    [...lightQuestions],
    [...mediumQuestions],
    [...deepQuestions]
];

const questionEl = document.getElementById("question");

/* =======================
   SCRAMBLE (НЕ МЕНЯЛ)
======================= */

const randomChars =
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюя0123456789!@#$%^&*()";

function randomChar() {
    return randomChars[Math.floor(Math.random() * randomChars.length)];
}

function scrambleText(finalText, duration = 2000) {
    isAnimating = true;

    const fixed = Array(finalText.length).fill(false);
    const indices = [...finalText.keys()].filter(i => finalText[i] !== " ");
    indices.sort(() => Math.random() - 0.5);

    let revealed = 0;
    const start = Date.now();

    const interval = setInterval(() => {
        const progress = Math.min((Date.now() - start) / duration, 1);
        const target = Math.floor(progress * indices.length);

        while (revealed < target) {
            fixed[indices[revealed++]] = true;
        }

        questionEl.textContent = finalText
            .split("")
            .map((c, i) => c === " " ? " " : fixed[i] ? c : randomChar())
            .join("");

        if (progress === 1) {
            clearInterval(interval);
            questionEl.textContent = finalText;
            isAnimating = false;
        }
    }, 30);
}

/* =======================
   ЛОГИКА ВЫДАЧИ
======================= */

function nextQuestion() {
    if (isAnimating) return;

    // 1️⃣ ЛЁГКИЕ
    if (stage === 0) {
        if (pools[0].length > 0) {
            const q = pools[0].splice(
                Math.floor(Math.random() * pools[0].length), 1
            )[0];
            scrambleText(q);
            return;
        } else {
            stage = 1;
            return; // ⛔ ждём следующего клика
        }
    }

    // 2️⃣ СРЕДНИЕ
    if (stage === 1) {
        if (pools[1].length > 0) {
            const q = pools[1].splice(
                Math.floor(Math.random() * pools[1].length), 1
            )[0];
            scrambleText(q);
            return;
        } else {
            stage = 2;
            return;
        }
    }

    // 3️⃣ СЛОЖНЫЕ
    if (stage === 2) {
        if (pools[2].length > 0) {
            const q = pools[2].splice(
                Math.floor(Math.random() * pools[2].length), 1
            )[0];
            scrambleText(q);
            return;
        } else {
            stage = 3;
            return;
        }
    }

    // 4️⃣ ФИНАЛЬНЫЙ
    if (stage === 3) {
        stage = 4;
        scrambleText(finalQuestion);
        return;
    }

    // 5️⃣ КОНЕЦ
    questionEl.textContent = "Всё! :)";
}


questionEl.addEventListener("click", nextQuestion);
</script>


