<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<meta name="viewport"
      content="width=device-width,
               initial-scale=1.0,
               maximum-scale=1.0,
               user-scalable=no,
               viewport-fit=cover">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Questions">

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">

<title>Questions</title>

<style>
html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
}

body {
    color: red;
    font-family: Arial, sans-serif;
    -webkit-tap-highlight-color: transparent;
}

/* STATUS BAR */
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: env(safe-area-inset-top);
    background: black;
    pointer-events: none;
}

/* HOME INDICATOR */
body::after {
    content: "";
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    height: env(safe-area-inset-bottom);
    background: black;
    pointer-events: none;
}

/* ЦЕНТР */
#container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;

    text-align: center;
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
}

#question {
    font-size: 32px;
    min-height: 80px;
    cursor: pointer;
    user-select: none;
    display: none;
    margin-bottom: 20px;
}

button {
    font-size: 24px;
    padding: 20px 50px;
    background: transparent;
    color: red;
    border: none;
    cursor: pointer;
}

button:active,
button:focus {
    background: transparent;
    outline: none;
}
</style>
</head>

<body>

<div id="container">
    <div id="question"></div>
    <button id="startButton">Старт</button>
</div>

<script>
// ⬇⬇⬇ ВОТ ЭТА СТРОКА БЫЛА КРИТИЧЕСКИ НУЖНА
let isAnimating = false;

const finalQuestion =
"Какой вопрос ты сам(а) хотел(а) бы, чтобы я тебе задал(а) - и какой был бы твой ответ?";

const questions = [
    "Какой твой самый большой страх?",
    "С каким животным я у тебя ассоциируюсь?",
    "Есть ли у тебя в жизни ситуация, глядя на которую спустя годы ты понимаешь, что нужно было поступить иначе?",
    "Что ты на самом деле очень любишь, но при этом не показываешь и не говоришь об этом другим, а может даже и демонстрируешь вообще обратное?",
    "Какая деталь тебе во мне нравится как в человеке на основе нашего общения?",
    "Какой теории ты придерживаешься: Земля плоская или сферическая (элипсообразная)? Автор вопроса: Юрий Лоза.",
    "Какой твой любимый цвет?",
    "Что тебе труднее всего говорить вслух даже близким?",
    "О чем ты чаще всего думаешь ночью, когда никто не отвлекает?",
    "Что тебя трогает до глубины, но ты это скрываешь?",
    "Какой комплимент тебе важнее всего услышать?",
    "В чём ты чаще всего сомневаешься в себе?",
    "Что тебя может прямо взбесить?",
    "Что тебя быстрее всего успокаивает?",
    "Что ты считаешь своей сильной стороной, но редко используешь?",
    "Какая привычка из детства до сих пор с тобой?",
    "Какая твоя маленькая слабость делает тебя тобой?",
    "Что для тебя значит «уважение» в отношениях?",
    "Что ты не успел(а) сказать человеку - и до сих пор помнишь?",
    "Что ты считаешь настоящей близостью?",
    "В каких ситуациях ты чувствуешь себя особенно одиноко?",
    "Как ты любишь, чтобы тебя поддерживали: словами, делом или присутствием?",
    "Что ты никогда не просишь, хотя тебе это нужно?",
    "Какое слово тебе нравится слышать в свой адрес?",
    "Какое твоё любимое воспоминание из детства?",
    "Что тебе во мне хочется понять глубже?",
    "Что ты ценишь в человеке больше всего?",
    "Что ты хочешь, чтобы я понял(а) про тебя без догадок - напрямую?",
    "Что во мне тебе откликается, потому что похоже на тебя?",
    "Что ты всегда прощаешь людям?",
    "В каких ситуациях ты чувствуешь ревность и почему?",
    "Какое твоё правило по жизни ты нарушаешь чаще всего?",
    "Что ты считаешь домом - это место или человек?",
    "Когда тебе плохо, ты хочешь, чтобы тебя оставили в покое или были рядом?",
    "Что ты хотел(а) бы научиться говорить без страха?",
    "Какой, по твоему мнению, твой самый сильный поступок, за который ты гордишься?"
];

let unusedQuestions = [...questions];
let finalQuestionShown = false;

const questionEl = document.getElementById("question");
const startButton = document.getElementById("startButton");

const randomChars =
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюя0123456789!@#$%^&*()";

function randomChar() {
    return randomChars[Math.floor(Math.random() * randomChars.length)];
}

function scrambleText(finalText, duration = 2000) {
    isAnimating = true;

    const length = finalText.length;
    const fixed = Array(length).fill(false);
    const indices = [];

    for (let i = 0; i < length; i++) {
        if (finalText[i] !== " ") indices.push(i);
    }

    indices.sort(() => Math.random() - 0.5);

    let revealed = 0;
    const startTime = Date.now();

    const interval = setInterval(() => {
        const progress = Math.min((Date.now() - startTime) / duration, 1);
        const target = Math.floor(progress * indices.length);

        while (revealed < target) {
            fixed[indices[revealed]] = true;
            revealed++;
        }

        let output = "";
        for (let i = 0; i < length; i++) {
            output += fixed[i] ? finalText[i] : (finalText[i] === " " ? " " : randomChar());
        }

        questionEl.textContent = output;

        if (progress === 1) {
            clearInterval(interval);
            questionEl.textContent = finalText;
            isAnimating = false;
        }
    }, 30);
}

function nextQuestion() {
    if (isAnimating) return;

    if (unusedQuestions.length === 0) {
        if (!finalQuestionShown) {
            finalQuestionShown = true;
            scrambleText(finalQuestion);
            return;
        }
        questionEl.textContent = "Всё! :)";
        questionEl.style.cursor = "default";
        return;
    }

    const index = Math.floor(Math.random() * unusedQuestions.length);
    const q = unusedQuestions.splice(index, 1)[0];
    scrambleText(q);
}

startButton.addEventListener("click", () => {
    startButton.style.display = "none";
    questionEl.style.display = "block";
    nextQuestion();
});

questionEl.addEventListener("click", nextQuestion);
</script>

</body>
</html>


