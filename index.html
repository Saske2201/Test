<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<meta name="viewport"
      content="width=device-width,
               initial-scale=1.0,
               maximum-scale=1.0,
               user-scalable=no,
               viewport-fit=cover">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<title>Questions</title>

<style>
html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
}

body {
    color: red;
    font-family: Arial, sans-serif;
    -webkit-tap-highlight-color: transparent;
}

/* STATUS BAR */
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: env(safe-area-inset-top);
    background: black;
}

/* HOME INDICATOR */
body::after {
    content: "";
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    height: env(safe-area-inset-bottom);
    background: black;
}

/* ЦЕНТР */
#container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;

    text-align: center;
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
}

#question {
    font-size: 32px;
    min-height: 80px;
    cursor: pointer;
    user-select: none;
    display: none;
}
</style>
</head>

<body>

<div id="container">
    <div id="question"></div>
    <div id="start" style="font-size:32px;cursor:pointer;">Старт</div>
</div>

<script>
let isAnimating = false;

/* =======================
   ВОПРОСЫ ПО УРОВНЯМ
======================= */

// 1️⃣ ЛЁГКИЕ (6)
const lightQuestions = [
    "Какой твой любимый цвет?",
    "С каким животным я у тебя ассоциируюсь?",
    "Какая привычка из детства до сих пор с тобой?",
    "Какое слово тебе нравится слышать в свой адрес?",
    "Что тебя быстрее всего успокаивает?",
    "Что ты считаешь своей маленькой слабостью?"
];

// 2️⃣ СРЕДНИЕ / СЛОЖНЫЕ (сюда же ЛОЗА)
const mediumQuestions = [
    "Какой твой самый большой страх?",
    "Что тебе труднее всего говорить вслух даже близким?",
    "В чём ты чаще всего сомневаешься в себе?",
    "Что тебя может прямо взбесить?",
    "Что ты ценишь в человеке больше всего?",
    "Какой теории ты придерживаешься: Земля плоская или сферическая (элипсообразная)? Автор вопроса: Юрий Лоза."
];

// 3️⃣ САМЫЕ ОТКРОВЕННЫЕ
const deepQuestions = [
    "Что ты на самом деле очень любишь, но скрываешь?",
    "Что ты не успел(а) сказать человеку — и до сих пор помнишь?",
    "В каких ситуациях ты чувствуешь себя особенно одиноко?",
    "Что ты считаешь настоящей близостью?",
    "Когда тебе плохо, ты хочешь, чтобы тебя оставили в покое или были рядом?"
];

// 4️⃣ ФИНАЛ
const finalQuestion =
"Какой вопрос ты сам(а) хотел(а) бы, чтобы я тебе задал(а) — и какой был бы твой ответ?";

/* =======================
   СОСТОЯНИЕ
======================= */

let stage = 0; // 0 — light, 1 — medium, 2 — deep, 3 — final, 4 — end

let pools = [
    [...lightQuestions],
    [...mediumQuestions],
    [...deepQuestions]
];

const questionEl = document.getElementById("question");
const startEl = document.getElementById("start");

/* =======================
   SCRAMBLE
======================= */

const randomChars =
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyzАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюя0123456789!@#$%^&*()";

function randomChar() {
    return randomChars[Math.floor(Math.random() * randomChars.length)];
}

function scrambleText(finalText, duration = 2000) {
    isAnimating = true;

    const fixed = Array(finalText.length).fill(false);
    const indices = [...finalText.keys()].filter(i => finalText[i] !== " ");
    indices.sort(() => Math.random() - 0.5);

    let revealed = 0;
    const start = Date.now();

    const interval = setInterval(() => {
        const progress = Math.min((Date.now() - start) / duration, 1);
        const target = Math.floor(progress * indices.length);

        while (revealed < target) {
            fixed[indices[revealed++]] = true;
        }

        questionEl.textContent = finalText
            .split("")
            .map((c, i) => c === " " ? " " : fixed[i] ? c : randomChar())
            .join("");

        if (progress === 1) {
            clearInterval(interval);
            questionEl.textContent = finalText;
            isAnimating = false;
        }
    }, 30);
}

/* =======================
   ЛОГИКА ВОПРОСОВ
======================= */

function nextQuestion() {
    if (isAnimating) return;

    if (stage <= 2) {
        if (pools[stage].length === 0) {
            stage++;
            nextQuestion();
            return;
        }

        const pool = pools[stage];
        const q = pool.splice(Math.floor(Math.random() * pool.length), 1)[0];
        scrambleText(q);
        return;
    }

    if (stage === 3) {
        stage++;
        scrambleText(finalQuestion);
        return;
    }

    questionEl.textContent = "Всё! :)";
}

/* =======================
   СОБЫТИЯ
======================= */

startEl.addEventListener("click", () => {
    startEl.style.display = "none";
    questionEl.style.display = "block";
    nextQuestion();
});

questionEl.addEventListener("click", nextQuestion);
</script>

</body>
</html>
