<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<!-- iOS / PWA -->
<meta name="viewport"
      content="width=device-width,
               initial-scale=1.0,
               maximum-scale=1.0,
               user-scalable=no,
               viewport-fit=cover">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Questions">

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">

<title>Questions</title>

<style>
/* –ë–ê–ó–ê */
html, body {
    margin: 0;
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
}

/* BODY */
body {
    color: red;
    font-family: Arial, sans-serif;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent; /* ‚ùó —É–±–∏—Ä–∞–µ–º iOS highlight */
}

/* üü• STATUS BAR */
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: env(safe-area-inset-top);
    background: black;
    z-index: 9999;
    pointer-events: none;
}

/* üü• HOME INDICATOR */
body::after {
    content: "";
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    height: env(safe-area-inset-bottom);
    background: black;
    z-index: 9999;
    pointer-events: none;
}

/* –¶–ï–ù–¢–† */
#container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
}

/* –í–û–ü–†–û–° */
#question {
    font-size: 32px;
    min-height: 80px;
    cursor: pointer;
    user-select: none;
    display: none;
    letter-spacing: 1px;
}

/* üî¥ –ö–ù–û–ü–ö–ê ‚Äî –ß–ò–°–¢–´–ô –¢–ï–ö–°–¢ */
button {
    font-size: 24px;
    padding: 20px 50px;
    background: transparent;     /* ‚ùå –Ω–∏–∫–∞–∫–æ–π –∑–∞–ª–∏–≤–∫–∏ */
    color: red;
    border: none;                /* ‚ùå –Ω–∏–∫–∞–∫–æ–π —Ä–∞–º–∫–∏ */
    outline: none;
    cursor: pointer;
}

/* ‚ùå –£–ë–ò–†–ê–ï–ú –í–°–ï ACTIVE / FOCUS –≠–§–§–ï–ö–¢–´ */
button:active,
button:focus,
button:focus-visible {
    background: transparent;
    color: red;
    outline: none;
    box-shadow: none;
}
</style>
</head>

<body>

<div id="container">
    <div id="question"></div>
    <button id="startButton">–°—Ç–∞—Ä—Ç</button>
</div>

<script>
// –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ iOS-–∑—É–º-–∂–µ—Å—Ç–æ–≤
document.addEventListener('gesturestart', e => e.preventDefault());

// service worker
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
}

// –í–û–ü–†–û–°–´
const questions = [
    "1",
    "2",
    "3",
    "4",
    "5",
    "6",
    "7"
];

let unusedQuestions = [...questions];
let isAnimating = false;

const questionEl = document.getElementById("question");
const startButton = document.getElementById("startButton");

// –°–ò–ú–í–û–õ–´
const randomChars =
    "ABCDEFGHIJKLMNOPQRSTUVWXYZ" +
    "abcdefghijklmnopqrstuvwxyz" +
    "–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø" +
    "–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è" +
    "0123456789!@#$%^&*()_+-=[]{}<>?/";

function randomChar() {
    return randomChars[Math.floor(Math.random() * randomChars.length)];
}

// SCRAMBLE
function scrambleText(finalText, duration = 2000) {
    isAnimating = true;

    const length = finalText.length;
    const fixed = Array(length).fill(false);

    const indices = [];
    for (let i = 0; i < length; i++) {
        if (finalText[i] !== " ") indices.push(i);
    }

    for (let i = indices.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [indices[i], indices[j]] = [indices[j], indices[i]];
    }

    let revealed = 0;
    const startTime = Date.now();

    const interval = setInterval(() => {
        const progress = Math.min((Date.now() - startTime) / duration, 1);
        const target = Math.floor(progress * indices.length);

        while (revealed < target) {
            fixed[indices[revealed]] = true;
            revealed++;
        }

        let output = "";
        for (let i = 0; i < length; i++) {
            if (finalText[i] === " ") {
                output += " ";
            } else if (fixed[i]) {
                output += finalText[i];
            } else {
                output += randomChar();
            }
        }

        questionEl.textContent = output;

        if (progress === 1) {
            clearInterval(interval);
            questionEl.textContent = finalText;
            isAnimating = false;
        }
    }, 30);
}

// –°–õ–ï–î–£–Æ–©–ò–ô –í–û–ü–†–û–°
function nextQuestion() {
    if (isAnimating) return;

    if (unusedQuestions.length === 0) {
        questionEl.textContent = "–í—Å—ë! :)";
        questionEl.style.cursor = "default";
        return;
    }

    const index = Math.floor(Math.random() * unusedQuestions.length);
    const q = unusedQuestions[index];
    unusedQuestions.splice(index, 1);

    scrambleText(q);
}

// –°–û–ë–´–¢–ò–Ø
startButton.addEventListener("click", () => {
    startButton.style.display = "none";
    questionEl.style.display = "block";
    nextQuestion();
});

questionEl.addEventListener("click", nextQuestion);
</script>

</body>
</html>
